# OpenAI API呼び出し戦略: フロントエンド vs バックエンド

「ChatGPT APIをどこから叩くべきか」というアーキテクチャ上の決定に関する分析です。

## 結論 (Conclusion)
**絶対に「バックエンド（サーバーサイド）」を経由してください。**
Next.jsを使っているため、`src/app/api/...` (Route Handlers) から呼ぶのが正解です。

フロントエンドから直接呼ぶことは、**セキュリティ事故に直結するため推奨しません**（プロトタイプ等のテスト用途を除く）。

---

## 理由 1: セキュリティ (API Keyの流出防止)

### Frontendから呼ぶ場合 (NG)
*   **仕組み**: ブラウザのJavaScriptが直接OpenAIのサーバーに通信します。
*   **リスク**: ブラウザで「検証ツール」のネットワークタブを見れば、**API Key (`sk-...`) が丸見え**になります。
    *   悪意ある第三者にキーを盗まれ、勝手に使われて**数十万円〜数百万円の請求**が来る被害が多発しています。

### Backendから呼ぶ場合 (OK)
*   **仕組み**:
    1.  Frontend → Backend (Next.js API Route) へ「質問」を送る。
    2.  Backend (API Key使用) → OpenAI へ問い合わせ。
    3.  Backend → Frontend へ「回答」を返す。
*   **メリット**: API Keyはサーバー内（環境変数）に隠蔽されるため、絶対に外部に漏れません。

## 理由 2: RAG機能の実装

### Frontend
*   RAGをするには、Vector DB (PostgreSQLなど) への接続が必要です。
*   ブラウザから直接DBに接続するのはセキュリティ的に**不可能（危険すぎる）**です。

### Backend
*   サーバーサイドなら安全にDBに接続できます。
    *   「ユーザーの質問を受け取る」
    *   → 「DBから関連情報を検索 (Search)」
    *   → 「検索結果をプロンプトに含めてOpenAIに投げる (Generate)」
*   このRAGの一連の流れをブラックボックス化できるのはバックエンドだけです。

## 理由 3: コスト管理と制限 (Rate Limiting)

*   **Frontend**: 誰でも無制限にリクエストを送れてしまいます（F5連打攻撃で破産のリスク）。
*   **Backend**: 「1ユーザーあたり1分間に5回まで」などの**制限 (Rate Limiting)** をかけることができます。IPアドレス制限なども容易です。

## まとめ

Next.js (App Router) を使用している今回の場合、**`src/app/api/chat/route.ts`** というファイルを作成し、そこでOpenAI SDKを動かすのが標準的かつ最も安全な構成です。
これにより、XServer VPS上でも安全に、かつRAG等の複雑な処理を実装できます。

# 現行システムの課題分析と改善案 (Current System Analysis)

## 1. データ永続化とバックエンド (Persistence & Backend)
最大の課題は「バックエンドが存在せず、ブラウザ（Client-side）で完結している」点です。

### 課題 (Issues)
*   **データ消失リスク**: ブラウザのキャッシュをクリアすると、チェックイン情報や進行状況が消えます。
*   **データ共有不能**: Aさんが入力した情報を、同行者Bさんの端末で見ることができません。
*   **管理者連携なし**: ゲストが名簿を入力しても、施設の管理者はそのデータを受け取れません（サーバーに送信していないため）。
*   **予約照合なし**: 予約IDを入力しても、実際の予約DBと照合しておらず、Mockデータ（固定の成功パターン）を使用しています。

### 改善案 (Solutions)
*   PostgreSQL等のデータベースを構築し、Prismaで接続する。
*   チェックイン完了データをDBに `INSERT` するAPIを作成する。

## 2. セキュリティと認証 (Security & Auth)

### 課題 (Issues)
*   **認証の欠如**: URLパラメータ（`?id=xxx`）を知っていれば誰でもチェックイン画面にアクセスできてしまいます（セキュリティ侵害のリスク）。
*   **個人情報保護**: パスポート画像などのアップロード先がなく、セキュアなストレージ（S3やR2）への保存が必要です。
*   **シークレット管理**: APIキー（OpenAIなど）の呼び出し制限や監視が不十分になる可能性があります。

### 改善案 (Solutions)
*   **本人確認**: 予約IDに加えて、電話番号などによる2要素認証に近い確認フローを導入する。
*   **Secure Storage**: パスポート画像はPresigned URLを用いてS3等のプライベートバケツにアップロードする。

## 3. 決済機能 (Payment)

### 課題 (Issues)
*   **Mock決済**: 実際にクレジットカード処理を行っていません (`setTimeout`によるシミュレーション)。宿泊税の徴収が機能していません。

### 改善案 (Solutions)
*   **Stripe Integration**: Stripe Payment Elements を正式に組み込み、サーバーサイドで `PaymentIntent` を作成して決済を確定させる。

## 4. 品質保証とテスト (QA & Testing)

### 課題 (Issues)
*   **手動テスト依存**: 機能追加のたびに全フローを手動確認しており、バグ混入のリスクが高いです。
*   **バリデーション**: 入力フォームのバリデーション（電話番号の形式チェックなど）が簡易的です。

### 改善案 (Solutions)
*   **E2Eテスト**: Playwright導入。
*   **Zod**: バリデーションルールの厳格化。

## まとめ
現状は「**UI/UXのプロトタイプとしては完成度が高いが、業務アプリとしてはバックエンド連携が必須**」という状態です。次のフェーズでは、**DB構築とAPI実装**が最優先事項となります。
